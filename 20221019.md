# JWT

## 인증, Authentication

인증, Authentication은 쉽게 말해서 로그인. 즉 특정 서비스에 일정 권한이 주어진 사용자임을 아이디랑 패스워드 등을 통해서 인증 받는 것.

## 인가, Authorization

인가, Authorization은 이렇게 한 번 인증을 받은 사용자가 자신의 계정으로’만’ 할 수 있는 활동을 시도할 때 로그인 되어있을을 알아보고 허가를 해주는 것. 로그인이 유지되는 상태에서 일어나는 일.

**jwt는 인가에 관련된 기술**

사용자가 로그인을 하면 토근을 건네준다. 서버가 기억하고 있지 않음.

토큰은 인코딩 또는 암호화된 3가지 데이터를 이어붙인 스트링

마침표로 끊어져서 3부분으로 나뉜다. 각각 header, payload, verify signature로 구분된다.

payload를 Base64로 디코딩해보면 JSON형식으로 여러 정보들이 들어있다.

토큰이 누가 누구에게 발급했는지, 언제까지 유효한지 그리고 서비스가 사용자에게 이 토큰을 통해 공개하기 원하는 내용(사용자 닉네임, 서비스 상의 레벨, 관리자 여부 등)을 알 수 있다. 

이렇게 토큰에 담긴 사용자 정보 등의 데이터를 Claim이라고 한다.

헤더를 디코딩해보면 두가지 정보가 담겨있다.

먼저 type, 여기에는 언제나 JWT가 들어간다.
다른 하나는 alg, 알고리즘의 약자. 여기에는 3번 서명 값을 만드는데 사용될 알고리즘이 지정된다.  HS256 등여러 암호화 방식 중 하나를 지정할 수 있다. 

1번 헤더와 2번 페이로드, 그리고 ‘서버에 감춰놓은 비밀 값’ 이 셋을 이 암호화 알고리즘에 넣고 돌리면 3번 서명 값이 나온다. 

서버는 요청에 토큰 값이 실려들어오면 1, 2번의 값을 ‘서버의 비밀 키’와 함께 돌려봐서 계산된 결과값이 3번 서명 값과 일치하는 결과가 나오는지 확인한다. 
만약 2번 페이로드의 정보가 서버가 아닌 누군가에 의해 조금이라도 수정되었다면 당연히 안 맞음. 
3번 서명 값과 계산값이 일치하고, 유효기간도 지나지 않았다면 그 사용자는 로그인 된 회원으로서 인가를 받는다.

## JWT 인증 절차

1. 사용자 로그인 요청
2. 서버에서 암호화된 토큰 생성
3. 사용자는 토큰을 저장(cookie, state 등)
4. 이 후 모든 요청에 토큰을 태워 요청함
5. 서버는 토큰을 가지고 사용자 식별
